Minor bugfixes and design improvements